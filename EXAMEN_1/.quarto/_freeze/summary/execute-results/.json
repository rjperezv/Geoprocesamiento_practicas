{
  "hash": "526a66394eb1295110ead0f4f1f4cf64",
  "result": {
    "engine": "knitr",
    "markdown": "# Modelamiento\n\n## Modelamiento\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# -------------------\n# MODELADO DE DATOS DESDE EXCEL CON IMPUTACIÓN DE VALORES FALTANTES\n# -------------------\n\n# Cargar librerías necesarias\nlibrary(readxl)       # Para leer archivos Excel\nlibrary(terra)        # Para datos espaciales\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nterra 1.7.78\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)      # Para visualización\nlibrary(dplyr)        # Para manipulación de datos\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAdjuntando el paquete: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:terra':\n\n    intersect, union\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(caret)        # Para ajuste de modelos\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCargando paquete requerido: lattice\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(randomForest) # Random Forest\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nrandomForest 4.7-1.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nType rfNews() to see new features/changes/bug fixes.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAdjuntando el paquete: 'randomForest'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:ggplot2':\n\n    margin\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to GEOS 3.12.2, GDAL 3.9.3, PROJ 9.4.1; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\n# Leer datos desde el archivo Excel\nruta_excel <- \"D:\\\\DATOX\\\\Agrarias\\\\Pedo\\\\dat_total.xlsx\"\ndata_df <- read_excel(ruta_excel)\n\n# Ver los primeros registros de los datos cargados\nhead(data_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 30\n     ID   peh     CO   FOS_DIS  CICA    Ca     Mg     K   B_T ACI_INTER      SAL\n  <dbl> <dbl>  <dbl>     <dbl> <dbl> <dbl>  <dbl> <dbl> <dbl>     <dbl>    <dbl>\n1     2  5.96  1.06  49.8      20.5  23.8   10.6  0.449  38.7  0.000001 0.000001\n2     3  7.37  1.26   0.000001 16.5  14.7   25.5  1.14   53.1  0.000001 0.000001\n3     4  6.80 26.8   43.2      56.8  78.5  120.   8.07  332.   0.000001 0.000001\n4     5  8.18  0.627  0.000001  6.93 12.9    9.60 1.56   30.4  0.000001 0.000001\n5     6  6.84  0.464 51.4       8.76  5.53  14.1  1.6    25.0  0.000001 0.000001\n6     7  5.93  1.39   0.000001 26.3   7.65  15.0  1.88   28.4  0.000001 0.000001\n# ℹ 19 more variables: SBASES <dbl>, CE <dbl>, S_RAS <dbl>, S_PSI <dbl>,\n#   aspect <dbl>, cnvrgn_ <dbl>, hillshd <dbl>, pln_crv <dbl>, prfl_cr <dbl>,\n#   slope <dbl>, aspect.1 <dbl>, convergence_index <dbl>, hillshade <dbl>,\n#   plan_curvature <dbl>, profile_curvature <dbl>, slope.1 <dbl>,\n#   LATITUD <dbl>, LONGITUD <dbl>, ALTITUD <chr>\n```\n\n\n:::\n\n```{.r .cell-code}\n# Convertir a un objeto sf si contiene datos espaciales (ejemplo con columnas 'lon' y 'lat')\ndata_sf <- st_as_sf(data_df, coords = c(\"LONGITUD\", \"LATITUD\"), crs = 4326)\n\n# Resumen de los datos espaciales\nsummary(data_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       ID              peh               CO             FOS_DIS       \n Min.   :   2.0   Min.   : 3.838   Min.   : 0.0000   Min.   :  0.000  \n 1st Qu.: 263.5   1st Qu.: 5.400   1st Qu.: 0.2873   1st Qu.:  0.000  \n Median : 507.0   Median : 5.990   Median : 0.7908   Median :  0.000  \n Mean   : 513.9   Mean   : 6.050   Mean   : 1.1861   Mean   :  2.764  \n 3rd Qu.: 776.5   3rd Qu.: 6.604   3rd Qu.: 1.4526   3rd Qu.:  0.000  \n Max.   :1029.0   Max.   :10.698   Max.   :54.7524   Max.   :300.000  \n                                                                      \n      CICA              Ca               Mg                  K           \n Min.   : 0.000   Min.   : 0.010   Min.   :  0.00713   Min.   :0.003271  \n 1st Qu.: 9.739   1st Qu.: 3.892   1st Qu.:  1.16245   1st Qu.:0.139801  \n Median :16.191   Median : 8.849   Median :  2.94201   Median :0.294417  \n Mean   :18.440   Mean   :10.992   Mean   :  5.02733   Mean   :0.438936  \n 3rd Qu.:25.673   3rd Qu.:15.443   3rd Qu.:  6.84516   3rd Qu.:0.552177  \n Max.   :61.207   Max.   :78.457   Max.   :119.77511   Max.   :9.894780  \n                                                                         \n      B_T            ACI_INTER            SAL             SBASES      \n Min.   :  0.000   Min.   : 0.0000   Min.   : 0.000   Min.   :  0.00  \n 1st Qu.:  5.817   1st Qu.: 0.0000   1st Qu.: 0.000   1st Qu.: 60.66  \n Median : 14.220   Median : 0.0000   Median : 0.000   Median : 88.63  \n Mean   : 18.025   Mean   : 0.6879   Mean   : 9.562   Mean   : 74.68  \n 3rd Qu.: 26.806   3rd Qu.: 0.2901   3rd Qu.: 2.332   3rd Qu.:100.00  \n Max.   :332.365   Max.   :45.8527   Max.   :99.336   Max.   :112.76  \n                                                                      \n       CE               S_RAS             S_PSI              aspect         \n Min.   :  0.0000   Min.   :  0.000   Min.   :  0.0000   Min.   :1.821e+12  \n 1st Qu.:  0.0000   1st Qu.:  0.000   1st Qu.:  0.0000   1st Qu.:1.971e+14  \n Median :  0.0000   Median :  0.000   Median :  0.0000   Median :3.714e+14  \n Mean   :  0.6224   Mean   :  2.553   Mean   :  4.5090   Mean   :3.597e+14  \n 3rd Qu.:  0.0000   3rd Qu.:  0.000   3rd Qu.:  0.0138   3rd Qu.:5.098e+14  \n Max.   :101.4820   Max.   :205.448   Max.   :340.5535   Max.   :9.845e+14  \n                                                         NA's   :3          \n    cnvrgn_              hillshd             pln_crv          \n Min.   :-9.909e+14   Min.   :9.598e+11   Min.   :-5.017e+14  \n 1st Qu.:-2.911e+14   1st Qu.:7.238e+14   1st Qu.:-6.917e+12  \n Median : 1.569e+13   Median :7.744e+14   Median : 4.761e+11  \n Mean   : 1.481e+13   Mean   :6.570e+14   Mean   : 1.070e+12  \n 3rd Qu.: 2.952e+14   3rd Qu.:7.991e+14   3rd Qu.: 7.639e+12  \n Max.   : 9.846e+14   Max.   :9.928e+14   Max.   : 2.336e+14  \n NA's   :2            NA's   :2           NA's   :2           \n    prfl_cr               slope              aspect.1        \n Min.   :-1.165e+13   Min.   :0.000e+00   Min.   :1.821e+12  \n 1st Qu.:-3.595e+11   1st Qu.:1.855e+13   1st Qu.:2.062e+14  \n Median :-6.740e+03   Median :3.646e+13   Median :3.748e+14  \n Mean   : 1.991e+10   Mean   :8.545e+13   Mean   :3.649e+14  \n 3rd Qu.: 3.814e+11   3rd Qu.:7.583e+13   3rd Qu.:5.141e+14  \n Max.   : 8.156e+12   Max.   :7.502e+14   Max.   :9.845e+14  \n NA's   :2            NA's   :2           NA's   :3          \n convergence_index      hillshade         plan_curvature      \n Min.   :-9.909e+14   Min.   :9.598e+11   Min.   :-9.894e+14  \n 1st Qu.:-2.949e+14   1st Qu.:7.238e+14   1st Qu.:-2.289e+14  \n Median : 1.767e+13   Median :7.744e+14   Median : 7.727e+13  \n Mean   : 1.406e+13   Mean   :6.570e+14   Mean   : 2.374e+13  \n 3rd Qu.: 2.981e+14   3rd Qu.:7.991e+14   3rd Qu.: 2.825e+14  \n Max.   : 9.846e+14   Max.   :9.928e+14   Max.   : 9.946e+14  \n NA's   :2            NA's   :2           NA's   :2           \n profile_curvature       slope.1            ALTITUD         \n Min.   :-9.869e+14   Min.   :4.600e+01   Length:919        \n 1st Qu.:-2.210e+14   1st Qu.:1.813e+14   Class :character  \n Median :-3.417e+08   Median :3.087e+14   Mode  :character  \n Mean   : 2.888e+12   Mean   :3.510e+14                     \n 3rd Qu.: 2.495e+14   3rd Qu.:4.704e+14                     \n Max.   : 9.933e+14   Max.   :9.987e+14                     \n NA's   :2            NA's   :2                             \n          geometry  \n POINT        :919  \n epsg:4326    :  0  \n +proj=long...:  0  \n                    \n                    \n                    \n                    \n```\n\n\n:::\n\n```{.r .cell-code}\n#View(data_sf)\n\n# Solo interesan las covariables incluyendo la variable de pH\n# Convertir a dataframe para modelado, no se tiene en cuenta la columna ID\ndata_sf_df <- data.frame(data_sf)[2:25]  # Asegúrate de ajustar los índices según tus datos\n\n# Dividir los datos en conjunto de entrenamiento y prueba para pH (peh)\nset.seed(1002)  # Semilla para reproducibilidad\nindex <- createDataPartition(y = data_sf_df$peh, p = 0.75, list = FALSE)\ntrain <- data_sf_df[index, ]\ntest <- data_sf_df[-index, ]\n\n# Conjunto datos manteniendo la parte espacial.\ntrain_sf <- data_sf[index, ]\ntest_sf <- data_sf[-index, ]\n\n# Imputación de valores faltantes (opcional, aquí se usa la media para imputar)\ntrain <- train %>% mutate(across(everything(), ~ ifelse(is.na(.), mean(., na.rm = TRUE), .)))\n\n# Visualización de la distribución de las muestras\nggplot() +\n  geom_sf(data = data_sf, aes(color = peh), alpha = 0.5) +\n  geom_sf(data = test_sf, color = \"red\", size = 2) +\n  theme_minimal() +\n  labs(title = \"Distribución de Muestras\", color = \"Valores\")\n```\n\n::: {.cell-output-display}\n![](summary_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Ajuste del modelo Random Forest\n#modelo_rf <- randomForest(peh ~ ., data = train, importance = TRUE)\n\n# Predicción en el conjunto de prueba\n#predicciones <- predict(modelo_rf, newdata = test)\n```\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSee @knuth84 for additional discussion of literate programming\n",
    "supporting": [
      "summary_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}